<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Visual JSON Builder</title>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  
  <script>
  $( function() {
    $( "#accordion" ).accordion();
  } );

  function add_to_array(th){	
   			th.parent().append("<input type = 'text' value= 'new value' class='value-json' / >"); 
   			
	}





  $( function() {


  	$(".view-json").click(function(){


      $json_answer = Array();

      $(".attr-group").each(function(i){

      
                  var $line_answer = {};

                  $inputes = $(this).find(".name-json");
                  
                  $inputes.each(function(i){

                    $name = $(this).val();
                    console.log($name);
                    isarr = $(this).parent().parent().find(".value-json").length;
                    if(isarr > 1){
                      $value = Array();
                    }
                    
                    $(this).parent().parent().find(".value-json").each(function(i){
                      if(isarr > 1){
                        $value.push($(this).val());
                      }else{
                        $value = $(this).val();
                      }
                      
                      
                    });
                   
                    $line_answer[$name] = $value;
                   
                    //$line_answer.push (new {$name : $value});
                  //  $line_answer.push($value);
                    

                    
                  });


                $json_answer.push($line_answer);


      });

  		console.log($json_answer);
  		alert(JSON.stringify($json_answer));
  	});



    $( ".add-attr" ).click(function(){
    	$id = $(this).attr('group');
    	
    	$(".elements-group-"+$id).append("<div class='row'><div class='col-sm'><input type = 'text' value='new attr' class='name-json'/></div><div class='col-sm'><span class = 'delete-attr' onclick=\"$(this).parent().parent().remove();\">Delete attribute</span></div><div class='col-sm values-json'><input type = 'text' value= 'new value' class='value-json'/ > <span class='add-to-array' onclick=' add_to_array($(this));' > Add To Array </span></div></div>");
    	 $( "#accordion" ).accordion( "refresh" );
    });



    $(".add-element").click(function(){
    		$id = $(".attr-group").length + 1;
    		$("div#accordion").append("<h3 class='element"+$id+"'>Element "+$id+"</h3><div class='element-for-delete-"+$id+"'><div class='container'><div class='elements-group-"+$id+" attr-group'>	<div class='row'><div class='col-sm'><input type = 'text' value='name'class='name-json' /></div><div class='col-sm'></div><div class='col-sm'><input type = 'text'  value='value' class='value-json'/ ></div></div><div class='row'><div class='col-sm'><input type = 'text' value='label' class='name-json'/></div><div class='col-sm'>		     </div><div class='col-sm'><input type = 'text' value='value' class='value-json'/></div>  </div></div>	<div class='row'><div class='col-sm'></div><div class='col-sm'><button type='button' class='btn btn-secondary btn-lg add-attr-"+$id+"' group = '"+$id+"' >ADD Attribure</button></div><div class='col-sm'></div></div></div></div>");
    		 $( ".add-attr-"+$id ).click(function(){
			    	$id = $(this).attr('group');
			    	
			    	$(".elements-group-"+$id).append("<div class='row'><div class='col-sm'><input type = 'text' value='new attr' class='name-json'/></div><div class='col-sm'><span class = 'delete-attr' onclick=\"$(this).parent().parent().remove();\">Delete attribute</span></div><div class='col-sm values-json'><input type = 'text' value= 'new value' class='value-json'/ > <span class='add-to-array' onclick=' add_to_array($(this));' > Add To Array </span></div></div>");
			    	 $( "#accordion" ).accordion( "refresh" );
			    });


    });


	$(".add-element").click(function(){
	    $( "#accordion" ).accordion( "refresh" );
	 });

	$(".delete-last-element").click(function(){
		$id = $(".attr-group").length;
		$(".element"+$id).remove();
		$(".element-for-delete-"+$id).remove();

	});


  } );





  </script>

<style>
	h1 {
		font-family: Arial;
	}
	label.ui-widget{
		display: table;
	}
	.container .row{
		margin: 20px;
	}
	.delete-attr{
		color: #aa0000;
		cursor: pointer;
	}
	.add-to-array{
		color: #00aa00;
		cursor: pointer;
	}
  .footer{
    text-align: center;
  }
</style>

</head>
<body>

 
<div class="container">
  <div class="row">
    <div class="col-sm">
     
    </div>
    <div class="col-sm">
      <h3>Visual JSON Builder</h3>
 
    </div>
    <div class="col-sm">
      
    </div>
  </div>
</div> 
<div id="accordion">
  


  <h3 class="element-one">Element 1</h3>
  <div>

		 
		<div class="container">

		<div class="elements-group-1 attr-group">	
		  <div class="row">
		    <div class="col-sm">
		      <input type = "text" value="name" class="name-json" />
		    </div>
		    <div class="col-sm">
		     
		    </div>
		    <div class="col-sm">
		      <input type = "text"  value="value" class="value-json" / >
		    </div>
		  </div>

		   <div class="row">
		    <div class="col-sm">
		      <input type = "text" value="label" class="name-json" />
		    </div>
		    <div class="col-sm">
		     
		    </div>
		    <div class="col-sm">
		      <input type = "text" value="value"  class="value-json" />
		    </div>
		  </div>


 		</div>	
 			<div class="row">
		    <div class="col-sm">
		     
		    </div>
		    <div class="col-sm">
		     <button type="button" class="btn btn-secondary btn-lg add-attr" group = "1" >ADD Attribure</button>
		    </div>
		    <div class="col-sm">
		      
		    </div>
		  </div>
		</div> 

  
  </div>
 
</div>



 
<div class="container">
  <div class="row">
    <div class="col-sm">
      <button type="button" class="btn btn-primary btn-lg add-element">ADD Element</button>
    </div>
    <div class="col-sm">
     <button type="button" class="btn btn-danger delete-last-element">Delete Last Element</button>
    </div>
    <div class="col-sm">
      <button type="button" class="btn btn-secondary btn-lg view-json">View JSON</button>
    </div>
  </div>
</div> 
 <hr/>
 <div class="footer">ООО "Информационная система"</div>
<div class="footer">&#169; <a href="mailto:mikhail.mikhailov@icloud.com">mikhail.mikhailov@icloud.com</a>, 2019</div>
<div class="footer">tel: +7(903)823-14-79</div>


</body>
</html>